<!DOCTYPE HTML>
<html>
  <head> <meta charset="utf-8"/>
<meta name="generator" content="Docutils 0.16: http://docutils.sourceforge.net/" />
<title>Breakpoint: Docker for pentesters</title>
    <link rel="stylesheet" type="text/css" href="../style/base.css"/>
    <link rel="stylesheet" type="text/css" href="../style/pygments.css"/>

    <link rel="alternate" type="application/rss+xml" title="Breakpoint RSS" href="../rss.xml"/>
  </head>
  <body>
    <header class="site-header">
      <div class="site-title">
        <div class="title-text">
          <h1>Breakpoint</h1>
          <h2>Stepping through security</h2>
        </div>
        <img src="../image/tomoko1.png"/>
      </div>
      <div class="wrap">
        <ul>
          <li><a href="../index.html">Index</a></li>
          <li><a href="https://github.com/cym13">Github</a></li>
          <li><a href="../soc.html">SoC</a></li>
          <li><a href="../about.html">About</a></li>
        </ul>
      </div>
    </header>

    <div class="content">
      <div class="section" id="docker-for-pentesters">
<h1>Docker for pentesters</h1>
<div class="section" id="setting-the-course">
<h2>Setting the course</h2>
<div class="section" id="docker-that-light-vm-thing-for-developers">
<h3>Docker? That light VM thing for developers?</h3>
<p>If you're in the industry you've certainly heard the name &quot;Docker&quot; by now.
It is often presented as a light VM used by developers to automate
deployment and <a class="reference external" href="https://blog.docker.com/2016/05/docker-101-getting-to-know-docker/">many</a> <a class="reference external" href="https://www.infoworld.com/article/3077875/linux/containers-101-docker-fundamentals.html">articles</a> <a class="reference external" href="https://www.networkworld.com/article/2361465/cloud-computing/docker-101-what-it-is-and-why-it-s-important.html">were</a> <a class="reference external" href="https://auth0.com/blog/docker-101-for-developers/">written</a> along that line.</p>
<p>I'd like to try to present another angle of Docker. I won't delve into its
internals, explain how it works or how it can make development and
deployment easier. Instead I'd like to show how security professionals can
use it in their daily assessments.</p>
</div>
<div class="section" id="ok-but-for-pentesters-really">
<h3>Ok, but for pentesters, really?</h3>
<p>There are many cases where security professionals need to see an application
running. For example it can help eliminate false positives while performing a
code review. Having the server running on your own computer also means you
are able to track down network streams at will, see what files change in what
ways when you perform such and such actions and all this without risking
putting the production down.</p>
<p>I use Docker whenever possible when I have a code review to do because while
I love reading the code there are many assumptions that are more quickly
grasped when seeing it running at least once in its expected configuration.</p>
<p>I also use it when pentesting on a customer's network if I find an
open-source application I don't know well. That allows me to quickly see what
the default configuration may be, what components it relies on, what the
default password is if there's one etc. It also means I'm able to try finding
a new vulnerability in that version first before trying it out on the real
server.</p>
<p>It can also be useful to quickly try new tools such as web scanners without
having to configure them in any way. In 5 minutes the container is up and
running and you can start poking at your target.</p>
<img alt="../image/cmc_paper_boat.png" src="../image/cmc_paper_boat.png" style="width: 60%;" />
</div>
<div class="section" id="so-what-is-docker">
<h3>So what is Docker?</h3>
<p>A Docker container is not a VM. It's a way to run a process just like any
other on your computer, while lying to it to make it think it's on a whole
different environment. This means it's very light as you're just running
normal processes and not a completely different system with its own emulated
hardware or separate kernel.</p>
<p>This last point also hints at a very important limitation of Docker
containers: the kernel is shared between the host and all containers. Any
kernel exploit would result in a major privilege escalation.</p>
<p>Furthermore Docker containers can be made public through a common
repositories. Well, to be exact the container itself isn't shared, instead a
Dockerfile is which is a configuration file used to setup and run a
container. This is all very similar to AUR in the Archlinux world and will be
transparent to us.</p>
</div>
</div>
<div class="section" id="setting-up-the-container">
<h2>Setting up the container</h2>
<div class="section" id="installation">
<h3>Installation</h3>
<p>Just install it from your favorite package manager and ensure the daemon is
running. There's nothing to setup. You may want to add yourself to the
<strong>docker</strong> group to use it as a regular user, but note that it is very useful
to <a class="reference external" href="https://fosterelli.co/privilege-escalation-via-docker">elevate your privileges to root</a> if you do so. The
basic idea is that since any process in the container is root you can run a
container that maps the host's /etc directory and you will have the right to
modify /etc/shadow from within the container. Fun stuff.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Having docker available to regular users is equivalent to giving them sudo
without password.</p>
</div>
</div>
<div class="section" id="finding-a-new-image">
<h3>Finding a new image</h3>
<p>In this example we'll setup an OpenVAS container.</p>
<p>Let's first search the main repository for OpenVAS containers:</p>
<pre class="literal-block">$ docker search openvas
NAME                              DESCRIPTION
STARS               OFFICIAL            AUTOMATED
mikesplain/openvas                A docker container for OpenVAS
77                                      [OK]
combro2k/openvas
3                                       [OK]
ictu/openvas-docker               OpenVAS scanscript in Docker container
2                                       [OK]
sergekatzmann/openvas8-complete   Docker container for OpenVAS8
1                                       [OK]
[...]</pre>
<p>We see many people have been publishing OpenVAS containers. They are sorted
by popularity which is measured in stars. We don't have any special
requirement so let's just take the first one.</p>
<pre class="literal-block">$ docker run --rm mikesplain/openvas</pre>
<p>As we've never ran that image before it will download it, configure it and
start it. This can take a few minutes. OpenVAS kindly tells us at some point
that &quot;your OpenVAS-9 installation is OK&quot; so we must be finished.</p>
<p>The flag <em>--rm</em> is used to automatically remove the container once stopped.
Otherwise the container is still present and can be inspected or restarted.</p>
</div>
<div class="section" id="getting-infos">
<h3>Getting infos</h3>
<p>Let's check our running container out:</p>
<pre class="literal-block">$ docker ps
CONTAINER ID        IMAGE                COMMAND               CREATED
STATUS              PORTS               NAMES

63c489feb707        mikesplain/openvas   &quot;/bin/sh -c /start&quot;   8 minutes
ago       Up 7 minutes        443/tcp, 9390/tcp   elegant_lovelace</pre>
<p>The name &quot;elegant_lovelace&quot; may be different for you as it is randomly
generated. It is just an easier way to refer to the container ID. We also see
the application bound the ports 443 and 9390. But what is its IP address?</p>
<p>The &quot;inspect&quot; command is used to gather all sorts of details on our
containers.</p>
<pre class="literal-block">$ docker inspect elegant_lovelace | grep IPAddress
        &quot;SecondaryIPAddresses&quot;: null,
        &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,
                &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</pre>
</div>
<div class="section" id="getting-access">
<h3>Getting access</h3>
<p>Ok, let's connect to our application on <a class="reference external" href="https://172.17.0.2/">https://172.17.0.2/</a>. We're asked for
a password but admin/admin isn't that hard to guess. And that's it, we've got
it running!</p>
<p>We're not limited to a web interface though, we can also get a shell if
needed:</p>
<pre class="literal-block">$ docker exec -ti elegant_lovelace /bin/bash
root&#64;63c489feb707:/#</pre>
<p>As <strong>man docker-exec</strong> kindly tells us the option <strong>-t</strong> is used to get a TTY
and <strong>-i</strong> to run the command interactively.</p>
<p>Here we encountered the most common case where the container starts a server
that keeps it from shutting down. Sometimes it isn't that easy and the
container expects you to open an interactive shell from the start instead in
order to configure and run the application. That can be done in our example
with:</p>
<pre class="literal-block">$ docker run -ti mikesplain/openvas /bin/bash</pre>
</div>
<div class="section" id="exposing-the-service">
<h3>Exposing the service</h3>
<p>At the moment the container runs on a local network, with locally bound ports
and an isolated file system. We can extend these capabilities by bounding a
port (443) to one on our local machine (here 8443).</p>
<pre class="literal-block">$ docker run -p 8443:443 mikesplain/openvas
$ docker ps
CONTAINER ID        IMAGE                COMMAND               CREATED
STATUS              PORTS                             NAMES

63c489feb707        mikesplain/openvas   &quot;/bin/sh -c /start&quot;   About a
minute ago   Up About a minute   9390/tcp, 0.0.0.0:8443-&gt;443/tcp
elegant_lovelace</pre>
<p>As we can see the internal port 443 is now exposed on all interfaces of the
host on port 8443.</p>
<p>Similarly we can map host directories on container volumes. To do that use
the -v flag with absolute paths.</p>
<pre class="literal-block">$ mkdir log_openvas
$ docker run --rm -v &quot;$PWD/log_openvas:/var/log/openvas&quot; mikesplain/openvas
$ ls log_openvas
gsad.log  openvasmd.log  openvassd.dump  openvassd.messages</pre>
<p>This is especially useful to pass data to containers or inspect log files
while the application is running.</p>
</div>
<div class="section" id="cleanup">
<h3>Cleanup</h3>
<p>Ok, we've played with OpenVAS enough, found a few flaws or whatever, the
thing is we're done with it and want it gone. Let's stop it first. We'll then
remove the container and the original image to leave a clean system behind
us:</p>
<pre class="literal-block">$ docker stop elegant_lovelace
$ docker rm elegant_lovelace
$ docker rmi mikesplain/openvas</pre>
<p>And that's it, we're done here. If there is any doubt you can check what
stopped containers and images are present with:</p>
<pre class="literal-block">$ docker ps -a
$ docker images</pre>
</div>
</div>
<div class="section" id="sailing-away">
<h2>Sailing away</h2>
<img alt="../image/mane_six_boat.png" src="../image/mane_six_boat.png" style="width: 60%;" />
<p>As we saw, using Docker to quickly install, setup, use and remove a whole
application is very easy. Here are all the commands we used:</p>
<pre class="literal-block">docker search &lt;application&gt;
docker run &lt;image name&gt;
docker ps
docker inspect &lt;container name&gt;
docker exec -ti &lt;container name&gt; /bin/bash
docker stop &lt;container name&gt;
docker rm &lt;container name&gt;
docker rmi &lt;image name&gt;</pre>
<p>That's all there is to know from a pentester's point of view. There's much
more to Docker than that though as we didn't talk about creating our own
images or actually configuring anything: it really is a powerful tool. But
all these are beyond the ambitions of our article which I hope was of some
help to you.</p>
<p>Happy sailing!</p>
</div>
<div class="section" id="edit">
<h2>Edit</h2>
<p>20/42/2020: I added some new information that people found useful, such as
how to mount volumes and expose ports.</p>
<div class="section" id="image-sources">
<h3>Image sources</h3>
<ul class="simple">
<li><p><a class="reference external" href="https://dmn666.deviantart.com/art/We-Were-Sailing-Along-295674765">https://dmn666.deviantart.com/art/We-Were-Sailing-Along-295674765</a></p></li>
<li><p><a class="reference external" href="https://jeatz-axl.deviantart.com/art/Mane-Six-On-A-Boat-675692297">https://jeatz-axl.deviantart.com/art/Mane-Six-On-A-Boat-675692297</a></p></li>
</ul>
</div>
</div>
</div>
    </div>
    <footer "class"="site-footer">
      <div "class"="publication_date">
        First published: Sat, 24 Feb 2018 11:11:44 +0100
      </div>
    </footer>
  </body>
</html>
